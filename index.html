<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ACTORA OS v6 [Mobile Ultimate]</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
    :root {
        --bg-1: #000000;
        --bg-2: #1a1a1a;
        --accent: #007AFF;
        --text: #ffffff;
        --glass: rgba(30, 30, 30, 0.65);
        --glass-border: rgba(255, 255, 255, 0.12);
        --radius: 18px;
        --dock-height: 85px;
        --anim: 0.35s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    [data-theme="light"] {
        --bg-1: #e0e0e0;
        --bg-2: #ffffff;
        --text: #000000;
        --glass: rgba(255, 255, 255, 0.65);
        --glass-border: rgba(0, 0, 0, 0.1);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
    
    body {
        margin: 0; padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop') center/cover no-repeat fixed;
        height: 100vh; overflow: hidden;
        color: var(--text);
        transition: filter 0.3s;
    }

    /* --- ANIMATIONS --- */
    @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    @keyframes wiggle { 0% { transform: rotate(0deg); } 25% { transform: rotate(-2deg); } 75% { transform: rotate(2deg); } 100% { transform: rotate(0deg); } }

    /* --- UTILS --- */
    .glass { background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid var(--glass-border); }
    .hidden { display: none !important; }
    .flex-center { display: flex; justify-content: center; align-items: center; }
    .btn {
        background: var(--accent); color: white; border: none; padding: 10px 18px; border-radius: 12px;
        font-weight: 600; font-size: 14px; transition: transform 0.1s; width: 100%; margin-top: 5px;
    }
    .btn:active { transform: scale(0.96); opacity: 0.8; }
    input, textarea {
        width: 100%; background: rgba(128,128,128,0.2); border: none; padding: 12px;
        border-radius: 10px; color: var(--text); margin-bottom: 10px; font-size: 16px;
    }

    /* --- LOCK SCREEN --- */
    #lock-screen {
        position: fixed; inset: 0; z-index: 10000; background: rgba(0,0,0,0.85); backdrop-filter: blur(20px);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        transition: transform 0.6s cubic-bezier(0.65, 0, 0.35, 1);
    }
    #lock-screen.unlocked { transform: translateY(-100%); }
    
    .pattern-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; position: relative; }
    #pattern-canvas { position: absolute; top: 0; left: 0; pointer-events: none; }
    .pattern-dot { 
        width: 15px; height: 15px; background: rgba(255,255,255,0.3); border-radius: 50%; 
        transition: 0.2s; border: 2px solid transparent; 
    }
    .pattern-dot.active { background: var(--accent); transform: scale(1.5); box-shadow: 0 0 15px var(--accent); }

    /* --- DESKTOP --- */
    #status-bar {
        position: fixed; top: 0; width: 100%; height: 44px; padding: 0 20px; z-index: 5000;
        display: flex; justify-content: space-between; align-items: center; font-size: 12px; font-weight: 600;
        background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent);
        text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    #desktop-area {
        position: absolute; top: 44px; bottom: 100px; width: 100%;
        display: grid; grid-template-columns: repeat(4, 1fr); grid-auto-rows: 90px;
        padding: 20px 10px; overflow-y: auto; align-content: start;
    }

    .app-icon {
        display: flex; flex-direction: column; align-items: center; gap: 6px; position: relative;
    }
    .app-icon.wiggle .icon-img { animation: wiggle 0.3s infinite; }
    .icon-img {
        width: 58px; height: 58px; border-radius: 14px; background: #333;
        display: flex; justify-content: center; align-items: center;
        font-size: 26px; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        transition: transform 0.2s;
    }
    .icon-label { font-size: 11px; text-shadow: 0 1px 3px rgba(0,0,0,0.8); color: white; text-align: center; max-width: 65px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .delete-badge {
        position: absolute; top: -5px; left: -5px; background: #ff3b30; width: 20px; height: 20px;
        border-radius: 50%; color: white; display: flex; justify-content: center; align-items: center; font-size: 12px;
        animation: zoomIn 0.2s; z-index: 10;
    }

    #dock {
        position: fixed; bottom: 15px; left: 15px; right: 15px; height: var(--dock-height);
        border-radius: 28px; display: flex; justify-content: space-evenly; align-items: center;
        z-index: 4000; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    /* --- WINDOWS --- */
    .window {
        position: fixed; inset: 0; background: var(--bg-1); z-index: 2000;
        display: flex; flex-direction: column; animation: zoomIn 0.3s var(--anim);
    }
    .window.closing { animation: zoomIn 0.2s reverse forwards; }
    
    .win-header {
        height: 50px; display: flex; align-items: center; padding: 0 15px;
        background: var(--glass); border-bottom: 1px solid var(--glass-border);
        justify-content: space-between; flex-shrink: 0;
    }
    .win-title { font-weight: 700; font-size: 15px; }
    .win-content { flex: 1; overflow-y: auto; padding: 15px; position: relative; color: var(--text); background: var(--bg-1); }

    /* --- CONTROL CENTER --- */
    #control-center {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 6000;
        background: rgba(0,0,0,0.4); opacity: 0; pointer-events: none; transition: 0.3s;
        display: flex; justify-content: center; padding-top: 50px;
    }
    #control-center.open { opacity: 1; pointer-events: auto; }
    #cc-panel {
        width: 90%; background: rgba(30,30,30,0.85); backdrop-filter: blur(30px);
        border-radius: 24px; padding: 20px; transform: translateY(-50px);
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        color: white; border: 1px solid rgba(255,255,255,0.1);
    }
    #control-center.open #cc-panel { transform: translateY(0); }

    .cc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
    .cc-tile {
        background: rgba(255,255,255,0.1); border-radius: 16px; padding: 15px;
        display: flex; flex-direction: column; gap: 10px; align-items: center; justify-content: center;
        height: 80px; transition: 0.2s;
    }
    .cc-tile.active { background: var(--accent); color: white; }

    /* --- CONTEXT MENU --- */
    #ctx-menu {
        position: fixed; width: 200px; background: rgba(40,40,40,0.95); backdrop-filter: blur(20px);
        border-radius: 12px; overflow: hidden; z-index: 9999;
        box-shadow: 0 15px 50px rgba(0,0,0,0.5); transform-origin: top left;
        animation: zoomIn 0.1s;
    }
    .ctx-item {
        padding: 12px 15px; display: flex; align-items: center; gap: 10px; font-size: 14px;
        border-bottom: 1px solid rgba(255,255,255,0.05); color: white;
    }
    .ctx-item:active { background: var(--accent); }

    /* --- APP SPECIFIC --- */
    .calculator-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; height: 100%; }
    .calc-btn { background: #333; border-radius: 50%; font-size: 20px; display: flex; align-items: center; justify-content: center; }
    .calc-btn.orange { background: #ff9f0a; color: white; }
    
    .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; }
    .gallery-item { aspect-ratio: 1; background: #333; object-fit: cover; width: 100%; }

    .todo-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: rgba(255,255,255,0.05); margin-bottom: 5px; border-radius: 8px; }

</style>
</head>
<body onload="OS.init()" oncontextmenu="return false;">

<div id="lock-screen">
    <div style="margin-bottom: 50px; text-align: center;">
        <img id="user-avatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 20px rgba(0,0,0,0.5);">
        <h2 id="lock-msg" style="font-weight: 300; margin-top: 15px;">Welcome</h2>
    </div>

    <div id="setup-wizard" class="hidden" style="width: 80%; text-align: center;">
        <h3>Create User</h3>
        <input type="text" id="setup-name" placeholder="Enter your name" style="text-align: center;">
        <p style="font-size: 12px; opacity: 0.7; margin: 20px 0;">Draw a pattern to secure your device</p>
        <div class="flex-center" style="position: relative; height: 300px;">
            <canvas id="setup-canvas" width="300" height="300" style="position: absolute; z-index: 2;"></canvas>
            <div class="pattern-grid" id="setup-grid"></div>
        </div>
        <button class="btn" onclick="Security.saveSetup()">Save & Boot</button>
    </div>

    <div id="unlock-interface" class="hidden">
        <div class="flex-center" style="position: relative; height: 300px; width: 300px;">
            <canvas id="unlock-canvas" width="300" height="300" style="position: absolute; z-index: 2;"></canvas>
            <div class="pattern-grid" id="unlock-grid"></div>
        </div>
        <div style="text-align: center; margin-top: 20px; font-size: 14px; opacity: 0.8;" onclick="Security.clearPattern()">Reset</div>
    </div>
</div>

<div id="status-bar" onclick="OS.toggleCC()">
    <span id="sb-clock">12:00</span>
    <div class="flex-center" style="gap: 8px;">
        <i class="fas fa-signal"></i>
        <i class="fas fa-wifi"></i>
        <i class="fas fa-battery-full"></i>
    </div>
</div>

<div id="desktop-area"></div>
<div id="dock" class="glass"></div>

<div id="control-center" onclick="if(event.target===this) OS.toggleCC()">
    <div id="cc-panel">
        <div class="cc-grid">
            <div class="cc-tile active" onclick="this.classList.toggle('active')"><i class="fas fa-wifi fa-2x"></i><span>Wi-Fi</span></div>
            <div class="cc-tile active" onclick="this.classList.toggle('active')"><i class="fas fa-bluetooth fa-2x"></i><span>Bluetooth</span></div>
            <div class="cc-tile" onclick="OS.toggleTheme(); this.classList.toggle('active')"><i class="fas fa-moon fa-2x"></i><span>Dark</span></div>
            <div class="cc-tile" onclick="Security.lock()"><i class="fas fa-lock fa-2x"></i><span>Lock</span></div>
        </div>
        <div style="margin-top: 15px;">
            <i class="fas fa-sun"></i>
            <input type="range" style="width: 85%; vertical-align: middle;">
        </div>
        <div style="margin-top: 15px;">
            <i class="fas fa-volume-up"></i>
            <input type="range" style="width: 85%; vertical-align: middle;">
        </div>
    </div>
</div>

<div id="ctx-menu" class="hidden"></div>

<script>
/**
 * ACTORA OS v6 [Mobile Ultimate]
 * Architecture: Modular Object Literals
 */

const Utils = {
    // Generates a UUID
    uuid: () => Date.now().toString(36) + Math.random().toString(36).substr(2),
    // Simple delay
    delay: (ms) => new Promise(res => setTimeout(res, ms)),
    // Play sound
    beep: (freq=500, dur=0.1) => {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain); gain.connect(ctx.destination);
        osc.frequency.value = freq;
        osc.start(); osc.stop(ctx.currentTime + dur);
    }
};

const Security = {
    user: null,
    pattern: [],
    isRecording: false,
    timer: null,

    init: function() {
        const saved = localStorage.getItem('actora_v6_user');
        if (saved) {
            this.user = JSON.parse(saved);
            document.getElementById('user-avatar').src = this.user.avatar;
            document.getElementById('lock-msg').innerText = `Welcome back, ${this.user.name}`;
            this.renderPatternGrid('unlock-grid', 'unlock-canvas', this.checkUnlock.bind(this));
            document.getElementById('unlock-interface').classList.remove('hidden');
        } else {
            document.getElementById('lock-msg').innerText = "Device Setup";
            document.getElementById('setup-wizard').classList.remove('hidden');
            this.renderPatternGrid('setup-grid', 'setup-canvas', (pat) => this.pattern = pat);
        }
        
        // Auto-lock timer (15 mins)
        document.addEventListener('touchstart', () => this.resetTimer());
        this.resetTimer();
    },

    resetTimer: function() {
        clearTimeout(this.timer);
        this.timer = setTimeout(() => this.lock(), 15 * 60 * 1000);
    },

    lock: function() {
        document.getElementById('lock-screen').classList.remove('unlocked');
        Utils.beep(300, 0.2);
    },

    renderPatternGrid: function(gridId, canvasId, callback) {
        const grid = document.getElementById(gridId);
        const cvs = document.getElementById(canvasId);
        const ctx = cvs.getContext('2d');
        grid.innerHTML = '';
        
        let path = [];
        const dots = [];

        // create 9 dots
        for(let i=0; i<9; i++) {
            const d = document.createElement('div');
            d.className = 'pattern-dot';
            d.dataset.index = i;
            grid.appendChild(d);
            dots.push(d);
        }

        const getTouchPos = (e) => {
            const rect = cvs.getBoundingClientRect();
            const t = e.touches[0];
            return { x: t.clientX - rect.left, y: t.clientY - rect.top };
        };

        const draw = (currPos) => {
            ctx.clearRect(0,0,300,300);
            ctx.strokeStyle = '#007AFF';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            if(path.length > 0) {
                ctx.beginPath();
                const start = dots[path[0]];
                ctx.moveTo(start.offsetLeft + 7, start.offsetTop + 7); // +7 for radius center approx
                
                for(let i=1; i<path.length; i++) {
                    const d = dots[path[i]];
                    ctx.lineTo(d.offsetLeft + 7, d.offsetTop + 7);
                }
                if(currPos) ctx.lineTo(currPos.x, currPos.y);
                ctx.stroke();
            }
        };

        cvs.addEventListener('touchstart', (e) => {
            e.preventDefault();
            path = [];
            dots.forEach(d => d.classList.remove('active'));
            draw();
        });

        cvs.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const pos = getTouchPos(e);
            
            // Collision detection
            dots.forEach((d, i) => {
                const dx = pos.x - (d.offsetLeft + 7);
                const dy = pos.y - (d.offsetTop + 7);
                if (Math.sqrt(dx*dx + dy*dy) < 20 && !path.includes(i)) {
                    path.push(i);
                    d.classList.add('active');
                    Utils.beep(600 + (i*50), 0.05);
                }
            });
            draw(pos);
        });

        cvs.addEventListener('touchend', () => {
            draw();
            if(callback) callback(path);
        });
    },

    saveSetup: function() {
        const name = document.getElementById('setup-name').value;
        if (!name || this.pattern.length < 3) {
            alert("Enter name and draw a complex pattern (3+ dots)");
            return;
        }
        this.user = {
            name: name,
            pattern: this.pattern,
            avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`,
            theme: 'dark'
        };
        localStorage.setItem('actora_v6_user', JSON.stringify(this.user));
        location.reload();
    },

    checkUnlock: function(enteredPath) {
        if (JSON.stringify(enteredPath) === JSON.stringify(this.user.pattern)) {
            Utils.beep(1000, 0.1);
            document.getElementById('lock-screen').classList.add('unlocked');
        } else {
            Utils.beep(200, 0.3);
            const grid = document.getElementById('unlock-grid');
            grid.animate([{transform:'translateX(-10px)'}, {transform:'translateX(10px)'}, {transform:'translateX(0)'}], {duration: 300});
            // Reset dots
            setTimeout(() => {
                document.querySelectorAll('.pattern-dot').forEach(d => d.classList.remove('active'));
                const ctx = document.getElementById('unlock-canvas').getContext('2d');
                ctx.clearRect(0,0,300,300);
            }, 500);
        }
    }
};

const Apps = {
    // 20 Apps Definition
    registry: [
        { id: 'settings', name: 'Settings', icon: 'fa-cog', color: '#8e8e93', render: () => Apps.renderSettings() },
        { id: 'files', name: 'Files', icon: 'fa-folder-open', color: '#007AFF', render: () => Apps.renderFiles() },
        { id: 'browser', name: 'Browser', icon: 'fa-globe', color: '#34C759', render: () => `<iframe src="https://www.bing.com" style="width:100%; height:100%; border:none;"></iframe>` },
        { id: 'calculator', name: 'Calc', icon: 'fa-calculator', color: '#FF9500', render: () => Apps.renderCalc() },
        { id: 'camera', name: 'Camera', icon: 'fa-camera', color: '#323232', render: () => Apps.renderCamera() },
        { id: 'notes', name: 'Notes', icon: 'fa-sticky-note', color: '#FFD60A', render: () => Apps.renderNotes() },
        { id: 'music', name: 'Music', icon: 'fa-music', color: '#FF2D55', render: () => `<div class="flex-center" style="height:100%; flex-direction:column;"><i class="fas fa-compact-disc fa-spin" style="font-size:100px; color:#333;"></i><h3>No Tracks</h3></div>` },
        { id: 'maps', name: 'Maps', icon: 'fa-map-marked-alt', color: '#30D158', render: () => `<div class="flex-center" style="height:100%; background:#e5e5e5; color:#333;">Map Simulation (Offline)</div>` },
        { id: 'weather', name: 'Weather', icon: 'fa-cloud-sun', color: '#5AC8FA', render: () => Apps.renderWeather() },
        { id: 'calendar', name: 'Calendar', icon: 'fa-calendar-alt', color: '#FF3B30', render: () => Apps.renderCalendar() },
        { id: 'clock', name: 'Clock', icon: 'fa-clock', color: '#000', render: () => Apps.renderClock() },
        { id: 'mail', name: 'Mail', icon: 'fa-envelope', color: '#007AFF', render: () => Apps.renderMail() },
        { id: 'photos', name: 'Photos', icon: 'fa-images', color: '#AF52DE', render: () => Apps.renderPhotos() },
        { id: 'store', name: 'Store', icon: 'fa-shopping-bag', color: '#007AFF', render: () => Apps.renderStore() },
        { id: 'todo', name: 'Tasks', icon: 'fa-check-circle', color: '#5856D6', render: () => Apps.renderTodo() },
        { id: 'paint', name: 'Paint', icon: 'fa-palette', color: '#FF9500', render: () => Apps.renderPaint() },
        { id: 'term', name: 'Terminal', icon: 'fa-terminal', color: '#333', render: () => Apps.renderTerminal() },
        { id: 'game', name: 'TicTacToe', icon: 'fa-gamepad', color: '#FF2D55', render: () => Apps.renderGame() },
        { id: 'contacts', name: 'Contacts', icon: 'fa-address-book', color: '#8e8e93', render: () => Apps.renderContacts() },
        { id: 'phone', name: 'Phone', icon: 'fa-phone', color: '#34C759', render: () => Apps.renderPhone() },
    ],

    open: function(appId) {
        Utils.beep(500, 0.05);
        const app = this.registry.find(a => a.id === appId);
        const win = document.createElement('div');
        win.className = 'window';
        win.id = `win-${appId}`;
        win.innerHTML = `
            <div class="win-header">
                <div class="win-title">${app.name}</div>
                <div onclick="Apps.close('${appId}')" style="background:#ff3b30; width:20px; height:20px; border-radius:50%; display:flex; justify-content:center; align-items:center;"><i class="fas fa-times" style="font-size:10px; color:white;"></i></div>
            </div>
            <div class="win-content">${app.render()}</div>
        `;
        document.body.appendChild(win);
        
        // Post-render scripts
        if(appId === 'paint') this.initPaint();
        if(appId === 'camera') this.initCamera();
    },

    close: function(appId) {
        const win = document.getElementById(`win-${appId}`);
        win.classList.add('closing');
        setTimeout(() => win.remove(), 200);
    },

    /* --- RENDER FUNCTIONS --- */
    renderSettings: () => `
        <h3>Profile</h3>
        <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; display:flex; align-items:center; gap:15px;">
            <img src="${Security.user.avatar}" style="width:50px; height:50px; border-radius:50%;">
            <div><b>${Security.user.name}</b><br><span style="font-size:12px;opacity:0.6">Secure User</span></div>
        </div>
        <h3>Security</h3>
        <div class="btn" onclick="document.getElementById('lock-screen').classList.remove('unlocked')">Lock Device</div>
        <div class="btn" style="background:#ff3b30" onclick="localStorage.clear(); location.reload()">Factory Reset</div>
    `,
    
    renderFiles: () => `
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
            ${['Docs', 'Images', 'System', 'Trash', 'Secret'].map(f => `
                <div style="text-align:center; padding:15px; background:rgba(255,255,255,0.05); border-radius:10px;">
                    <i class="fas fa-folder" style="font-size:40px; color:#FFD60A"></i><br>
                    <span style="font-size:12px">${f}</span>
                </div>
            `).join('')}
        </div>
    `,

    renderCalc: () => `
        <div class="calculator-grid">
            ${['C','/','*','-', '7','8','9','+', '4','5','6','=', '1','2','3','0'].map(k => 
                `<div class="calc-btn ${['C','/','*','-','+','='].includes(k)?'orange':''}" onclick="this.closest('.win-content').querySelector('input').value += '${k}'">${k}</div>`
            ).join('')}
            <input type="text" style="grid-column: span 4; text-align:right; font-size:30px; margin-bottom:0;" readonly>
        </div>
    `,

    renderTodo: () => `
        <input type="text" placeholder="Add Task..." onkeydown="if(event.key==='Enter'){ 
            this.nextElementSibling.innerHTML += '<div class=\'todo-item\'><i class=\'fas fa-check\'></i> '+this.value+'</div>'; this.value=''; 
        }">
        <div id="todo-list">
            <div class="todo-item"><i class="fas fa-check"></i> Welcome to Actora</div>
        </div>
    `,

    renderStore: () => `
        <h3>App Store</h3>
        <div style="display:grid; grid-template-columns:1fr; gap:10px;">
            ${['Pro Video', 'Cyber Game', 'Health+'].map(a => `
                <div style="display:flex; align-items:center; justify-content:space-between; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <div style="width:40px; height:40px; background:#333; border-radius:8px;"></div>
                        <b>${a}</b>
                    </div>
                    <button class="btn" style="width:auto; padding:5px 15px;">Get</button>
                </div>
            `).join('')}
        </div>
    `,

    renderWeather: () => `
        <div style="text-align:center; padding-top:40px;">
            <i class="fas fa-sun" style="font-size:60px; color:#FFD60A"></i>
            <h1>24°C</h1>
            <p>Clear Sky</p>
            <div style="display:flex; justify-content:space-between; margin-top:40px; padding:0 20px;">
                <span>Mon<br>22°</span><span>Tue<br>25°</span><span>Wed<br>21°</span><span>Thu<br>24°</span>
            </div>
        </div>
    `,

    renderClock: () => `
        <div style="text-align:center; padding-top:50px;">
            <h1 style="font-size:60px; font-weight:200;">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</h1>
            <p style="opacity:0.6">${new Date().toDateString()}</p>
            <div class="btn" onclick="alert('Timer Set')">Start Timer</div>
        </div>
    `,

    renderPhotos: () => `
        <div class="gallery-grid">
            ${[1,2,3,4,5,6,7,8,9].map(i => `<img class="gallery-item" src="https://picsum.photos/200?random=${i}">`).join('')}
        </div>
    `,

    renderPaint: () => `<canvas id="paint-canvas" style="background:white; width:100%; height:100%; touch-action:none;"></canvas>`,
    initPaint: () => {
        const c = document.getElementById('paint-canvas');
        c.width = c.clientWidth; c.height = c.clientHeight;
        const ctx = c.getContext('2d');
        let painting = false;
        c.ontouchstart = (e) => { painting=true; ctx.beginPath(); ctx.moveTo(e.touches[0].clientX, e.touches[0].clientY - 100); };
        c.ontouchmove = (e) => { if(painting){ e.preventDefault(); ctx.lineTo(e.touches[0].clientX, e.touches[0].clientY - 100); ctx.stroke(); }};
        c.ontouchend = () => painting=false;
    },

    renderCamera: () => `<video id="cam-feed" autoplay playsinline style="width:100%; height:100%; object-fit:cover; background:black;"></video>`,
    initCamera: async () => {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            document.getElementById('cam-feed').srcObject = stream;
        } catch(e) { document.getElementById('cam-feed').parentNode.innerHTML = '<div class="flex-center" style="height:100%">Camera Blocked</div>'; }
    },

    renderTerminal: () => `
        <div style="font-family:monospace; font-size:12px; color:#0f0;">
            <div>> boot_sequence --init</div>
            <div>> loading kernel... OK</div>
            <div>> mounting /dev/sda1... OK</div>
            <div>> actora_os_v6 loaded</div>
            <div style="margin-top:10px;">> <span id="cursor">_</span></div>
        </div>
    `,

    renderGame: () => `
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:5px; height:300px; width:300px; margin:20px auto;">
            ${[0,1,2,3,4,5,6,7,8].map(i => `<div onclick="this.innerText='X'; this.style.pointerEvents='none'" style="background:rgba(255,255,255,0.1); display:flex; justify-content:center; align-items:center; font-size:40px;"></div>`).join('')}
        </div>
        <div style="text-align:center;">You are X</div>
    `,

    renderPhone: () => `
        <div style="text-align:center; font-size:30px; margin:20px 0;" id="dial-display"></div>
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:15px; padding:20px;">
            ${[1,2,3,4,5,6,7,8,9,'*',0,'#'].map(n => `<div class="btn" style="border-radius:50%; width:60px; height:60px; margin:0 auto; padding:0; display:flex; justify-content:center; align-items:center; font-size:20px; background:#333;" onclick="document.getElementById('dial-display').innerText+='${n}'">${n}</div>`).join('')}
        </div>
        <div class="flex-center"><div class="btn" style="background:#34C759; width:60px; height:60px; border-radius:50%; display:flex; justify-content:center; align-items:center;"><i class="fas fa-phone"></i></div></div>
    `,

    renderNotes: () => `<textarea style="height:100%; width:100%; background:transparent; color:var(--text); font-size:16px;" placeholder="Type notes here..."></textarea>`,
    renderMail: () => `<div class="flex-center" style="height:100%">Inbox Empty</div>`,
    renderContacts: () => `<div class="flex-center" style="height:100%">No Contacts Found</div>`,
    renderCalendar: () => `<div class="flex-center" style="height:100%">Calendar Sync...</div>`
};

const OS = {
    editMode: false,

    init: function() {
        this.renderDesktop();
        this.startClock();
        Security.init();
        
        // Touch Handler for Context Menu (Long Press)
        let pressTimer;
        document.addEventListener('touchstart', (e) => {
            pressTimer = setTimeout(() => {
                this.showContext(e.touches[0].clientX, e.touches[0].clientY);
            }, 800);
        });
        document.addEventListener('touchend', () => clearTimeout(pressTimer));
        document.addEventListener('click', () => {
            document.getElementById('ctx-menu').classList.add('hidden');
            this.setEditMode(false);
        });
    },

    renderDesktop: function() {
        const d = document.getElementById('desktop-area');
        const dock = document.getElementById('dock');
        d.innerHTML = ''; dock.innerHTML = '';

        Apps.registry.forEach((app, i) => {
            const el = document.createElement('div');
            el.className = 'app-icon';
            el.innerHTML = `
                <div class="delete-badge hidden" onclick="event.stopPropagation(); alert('Cannot delete system apps')"><i class="fas fa-minus"></i></div>
                <div class="icon-img" style="background:${app.color}"><i class="fas ${app.icon}"></i></div>
                <div class="icon-label">${app.name}</div>
            `;
            el.onclick = () => { if(!this.editMode) Apps.open(app.id); };
            
            // First 4 apps to dock
            if(i < 4) {
                const dockEl = el.cloneNode(true);
                dockEl.querySelector('.icon-label').remove();
                dockEl.onclick = () => Apps.open(app.id);
                dock.appendChild(dockEl);
            } else {
                d.appendChild(el);
            }
        });
    },

    showContext: function(x, y) {
        Utils.beep(300, 0.05);
        const m = document.getElementById('ctx-menu');
        m.style.left = Math.min(x, window.innerWidth - 210) + 'px';
        m.style.top = Math.min(y, window.innerHeight - 200) + 'px';
        m.innerHTML = `
            <div class="ctx-item" onclick="OS.setEditMode(true)"><i class="fas fa-arrows-alt"></i> Rearrange Icons</div>
            <div class="ctx-item" onclick="OS.toggleTheme()"><i class="fas fa-adjust"></i> Change Theme</div>
            <div class="ctx-item" onclick="location.reload()" style="color:#ff3b30"><i class="fas fa-power-off"></i> Restart</div>
        `;
        m.classList.remove('hidden');
    },

    setEditMode: function(active) {
        this.editMode = active;
        document.querySelectorAll('.app-icon').forEach(el => {
            if(active) {
                el.classList.add('wiggle');
                el.querySelector('.delete-badge').classList.remove('hidden');
            } else {
                el.classList.remove('wiggle');
                el.querySelector('.delete-badge').classList.add('hidden');
            }
        });
    },

    toggleCC: function() {
        document.getElementById('control-center').classList.toggle('open');
    },

    toggleTheme: function() {
        const b = document.body;
        b.setAttribute('data-theme', b.getAttribute('data-theme') === 'light' ? 'dark' : 'light');
    },

    startClock: function() {
        setInterval(() => {
            document.getElementById('sb-clock').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        }, 1000);
    }
};
</script>
</body>
</html>